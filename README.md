# 以太坊钱包后端服务

这是一个基于 Go Gin 框架构建的以太坊钱包后端服务。它提供了一套完整的 RESTful API，用于管理钱包、查询链上数据、发送交易、与 ERC20 代币交互以及进行数字签名。

## ✨ 功能特性

### 钱包管理
- **助记词导入**: 通过助记词派生并返回钱包地址，但不存储助记词以确保安全。
- **余额查询**:
  - 查询指定地址的 ETH 余额。
  - 查询指定地址的 ERC20 代币余额。
- **Nonce 查询**: 获取地址的 `latest` 和 `pending` nonce。

### 交易处理
- **ETH 转账**:
  - **基础发送**: 快速发送 ETH。
  - **高级发送**: 自定义 `gas` 和 `nonce` 进行发送。
- **ERC20 转账**:
  - **基础发送**: 快速发送 ERC20 代币。
  - **高级发送**: 自定义 `gas` 和 `nonce` 进行发送。
- **Gas 估算**: 估算交易所需的 `gas limit`。
- **Gas 建议**: 获取 EIP-1559 和 legacy 两种模式下的 `gas` 价格建议。
- **交易广播**: 广播已签名的原始交易。
- **交易回执**: 查询交易回执，并在交易失败时尝试返回 revert reason。

### ERC20 代币
- **元数据查询**: 获取 ERC20 代币的名称、符号和小数位数。
- **授权 (Approve)**: 对 `spender` 地址进行 ERC20 代币授权。
- **授权额度查询 (Allowance)**: 查询 `owner` 对 `spender` 的授权额度。

### 签名服务
- **文本消息签名**: 使用 `personal_sign` 标准对文本消息进行签名。
- **EIP-712 签名**: 对符合 EIP-712 标准的 typed data 进行签名。

## 🏛️ 项目架构

项目采用分层架构，确保代码的模块化和可维护性。

- **/api**: API 层，负责处理 HTTP 请求和响应。
  - **/handlers**: 包含所有 HTTP `handler`，负责解析请求、调用 `service` 并返回响应。
  - **/router**: 定义所有 API 路由，并将它们与 `handler` 关联。
  - **/middleware**: 包含中间件，如错误处理、日志记录等。
- **/core**: 核心逻辑层，封装了与以太坊节点的交互。
  - **evm_adapter.go**: 封装了与以太坊 JSON-RPC 的所有交互，例如查询余额、发送交易等。
  - **hd.go**: 实现了 HD 钱包的助记词派生逻辑。
- **/services**: 服务层，封装了核心业务逻辑。
  - **wallet_service.go**: 组合 `core` 层的功能，为 `api` 层提供统一的业务接口。
- **/config**: 配置管理。
- **/pkg**: 工具包，提供项目范围内的通用功能。
- **main.go**: 项目入口文件。
- **openapi.yaml**: API 规范文档。

## 🚀 快速开始

### 环境要求
- Go 1.18+
- 一个以太坊节点 RPC URL (例如 [Infura](https://infura.io/) 或 [Alchemy](https://www.alchemy.com/))

### 安装与运行
1. **克隆项目**:
   ```bash
   git clone https://github.com/your-username/wallet.git
   cd wallet
   ```

2. **配置节点**:
   打开 `config/config.yaml` 文件，将 `rpc_url` 修改为你的以太坊节点 RPC URL。

3. **安装依赖**:
   ```bash
   go mod tidy
   ```

4. **运行服务**:
   ```bash
   go run main.go
   ```
   服务默认启动在 `http://localhost:8080`。

### API 文档
项目启动后，你可以通过 [Swagger Editor](https.editor.swagger.io/) 或其他兼容工具导入根目录下的 `openapi.yaml` 文件来查看和测试所有 API 接口。

## 未来功能与改进

为了使钱包服务更加完善，可以考虑增加以下功能：

### ⛓️ 多链支持
- **动态网络切换**: 支持在运行时切换不同的 EVM 兼容链（如 Polygon, BSC, Arbitrum）。
- **链配置管理**: 通过配置文件或 API 管理多条链的 RPC 端点和 `chain_id`。

### 🖼️ NFT (非同质化代币)
- **资产查询**: 查询并展示用户持有的 ERC-721 和 ERC-1155 代币。
- **NFT 转账**: 发送 NFT 代币。
- **元数据获取**: 获取 NFT 的元数据和图像。

### 🔐 安全与钱包管理
- **助记词加密存储**: 提供选项让用户加密并安全地存储助记词。
- **多账户管理**: 支持从单个助记词派生和管理多个地址。
- **地址簿**: 管理常用联系人地址。

### 📈 DeFi 与高级功能
- **交易历史**: 提供 API 来查询和过滤用户的交易历史。
- **代币价格**: 集成价格预言机（如 Chainlink）或第三方 API 来显示代币的法币价值。
- **Swap 集成**: 集成去中心化交易所（DEX）的路由协议，实现代币兑换功能。

### ⚙️ 开发者体验
- **WebSocket 支持**: 通过 WebSocket 提供实时的链上事件通知（如新区块、交易确认）。
- **插件系统**: 设计一个插件系统，允许开发者轻松扩展新功能。